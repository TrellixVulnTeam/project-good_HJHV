{"ast":null,"code":"import { isFunction, logger, throttle } from \"@rpldy/shared\";\nimport addLife from \"@rpldy/life-events\";\nimport defaultSend from \"@rpldy/sender\";\nimport { PROGRESS_DELAY, SENDER_EVENTS } from \"./consts\";\nimport { DEFAULT_OPTIONS, DEFAULT_PARAM_NAME } from \"./defaults\";\n\nconst reportItemsProgress = (items, completed, loaded, trigger) => {\n  items.forEach(item => {\n    logger.debugLog(`uploady.uploader.processor: file: ${item.id} progress event: loaded(${loaded}) - completed(${completed})`);\n    trigger(SENDER_EVENTS.ITEM_PROGRESS, item, completed, loaded);\n  });\n};\n\nconst onItemUploadProgress = (items, batch, e, trigger) => {\n  const completed = Math.min(e.loaded / e.total * 100, 100),\n        completedPerItem = completed / items.length,\n        loadedAverage = e.loaded / items.length;\n  reportItemsProgress(items, completedPerItem, loadedAverage, trigger);\n  trigger(SENDER_EVENTS.BATCH_PROGRESS, batch);\n};\n\nconst createBatchItemsSender = () => {\n  const {\n    trigger,\n    target: sender\n  } = addLife({\n    send: (items, batch, batchOptions) => {\n      const destination = batchOptions.destination,\n            url = destination === null || destination === void 0 ? void 0 : destination.url;\n      const throttledProgress = throttle(e => onItemUploadProgress(items, batch, e, trigger), PROGRESS_DELAY, true);\n      const send = isFunction(batchOptions.send) ? batchOptions.send : defaultSend;\n      return send(items, url, {\n        method: (destination === null || destination === void 0 ? void 0 : destination.method) || batchOptions.method || DEFAULT_OPTIONS.method,\n        paramName: (destination === null || destination === void 0 ? void 0 : destination.filesParamName) || batchOptions.inputFieldName || DEFAULT_PARAM_NAME,\n        params: { //TODO: might need to rethink the order here:\n          ...batchOptions.params,\n          ...(destination === null || destination === void 0 ? void 0 : destination.params)\n        },\n        forceJsonResponse: batchOptions.forceJsonResponse,\n        withCredentials: batchOptions.withCredentials,\n        formatGroupParamName: batchOptions.formatGroupParamName,\n        headers: destination === null || destination === void 0 ? void 0 : destination.headers,\n        sendWithFormData: batchOptions.sendWithFormData,\n        formatServerResponse: batchOptions.formatServerResponse\n      }, throttledProgress);\n    }\n  }, Object.values(SENDER_EVENTS));\n  return sender;\n};\n\nexport default createBatchItemsSender;","map":{"version":3,"sources":["C:/Users/USER/Documents/GitHub/project-good/project/client/node_modules/@rpldy/uploader/lib/esm/batchItemsSender.js"],"names":["isFunction","logger","throttle","addLife","defaultSend","PROGRESS_DELAY","SENDER_EVENTS","DEFAULT_OPTIONS","DEFAULT_PARAM_NAME","reportItemsProgress","items","completed","loaded","trigger","forEach","item","debugLog","id","ITEM_PROGRESS","onItemUploadProgress","batch","e","Math","min","total","completedPerItem","length","loadedAverage","BATCH_PROGRESS","createBatchItemsSender","target","sender","send","batchOptions","destination","url","throttledProgress","method","paramName","filesParamName","inputFieldName","params","forceJsonResponse","withCredentials","formatGroupParamName","headers","sendWithFormData","formatServerResponse","Object","values"],"mappings":"AAAA,SAASA,UAAT,EAAqBC,MAArB,EAA6BC,QAA7B,QAA6C,eAA7C;AACA,OAAOC,OAAP,MAAoB,oBAApB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,SAASC,cAAT,EAAyBC,aAAzB,QAA8C,UAA9C;AACA,SAASC,eAAT,EAA0BC,kBAA1B,QAAoD,YAApD;;AAEA,MAAMC,mBAAmB,GAAG,CAACC,KAAD,EAAQC,SAAR,EAAmBC,MAAnB,EAA2BC,OAA3B,KAAuC;AACjEH,EAAAA,KAAK,CAACI,OAAN,CAAcC,IAAI,IAAI;AACpBd,IAAAA,MAAM,CAACe,QAAP,CAAiB,qCAAoCD,IAAI,CAACE,EAAG,2BAA0BL,MAAO,iBAAgBD,SAAU,GAAxH;AACAE,IAAAA,OAAO,CAACP,aAAa,CAACY,aAAf,EAA8BH,IAA9B,EAAoCJ,SAApC,EAA+CC,MAA/C,CAAP;AACD,GAHD;AAID,CALD;;AAOA,MAAMO,oBAAoB,GAAG,CAACT,KAAD,EAAQU,KAAR,EAAeC,CAAf,EAAkBR,OAAlB,KAA8B;AACzD,QAAMF,SAAS,GAAGW,IAAI,CAACC,GAAL,CAASF,CAAC,CAACT,MAAF,GAAWS,CAAC,CAACG,KAAb,GAAqB,GAA9B,EAAmC,GAAnC,CAAlB;AAAA,QACMC,gBAAgB,GAAGd,SAAS,GAAGD,KAAK,CAACgB,MAD3C;AAAA,QAEMC,aAAa,GAAGN,CAAC,CAACT,MAAF,GAAWF,KAAK,CAACgB,MAFvC;AAGAjB,EAAAA,mBAAmB,CAACC,KAAD,EAAQe,gBAAR,EAA0BE,aAA1B,EAAyCd,OAAzC,CAAnB;AACAA,EAAAA,OAAO,CAACP,aAAa,CAACsB,cAAf,EAA+BR,KAA/B,CAAP;AACD,CAND;;AAQA,MAAMS,sBAAsB,GAAG,MAAM;AACnC,QAAM;AACJhB,IAAAA,OADI;AAEJiB,IAAAA,MAAM,EAAEC;AAFJ,MAGF5B,OAAO,CAAC;AACV6B,IAAAA,IAAI,EAAE,CAACtB,KAAD,EAAQU,KAAR,EAAea,YAAf,KAAgC;AACpC,YAAMC,WAAW,GAAGD,YAAY,CAACC,WAAjC;AAAA,YACMC,GAAG,GAAGD,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACC,GADlF;AAEA,YAAMC,iBAAiB,GAAGlC,QAAQ,CAACmB,CAAC,IAAIF,oBAAoB,CAACT,KAAD,EAAQU,KAAR,EAAeC,CAAf,EAAkBR,OAAlB,CAA1B,EAAsDR,cAAtD,EAAsE,IAAtE,CAAlC;AACA,YAAM2B,IAAI,GAAGhC,UAAU,CAACiC,YAAY,CAACD,IAAd,CAAV,GAAgCC,YAAY,CAACD,IAA7C,GAAoD5B,WAAjE;AACA,aAAO4B,IAAI,CAACtB,KAAD,EAAQyB,GAAR,EAAa;AACtBE,QAAAA,MAAM,EAAE,CAACH,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACG,MAAvE,KAAkFJ,YAAY,CAACI,MAA/F,IAAyG9B,eAAe,CAAC8B,MAD3G;AAEtBC,QAAAA,SAAS,EAAE,CAACJ,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACK,cAAvE,KAA0FN,YAAY,CAACO,cAAvG,IAAyHhC,kBAF9G;AAGtBiC,QAAAA,MAAM,EAAE,EAAE;AACR,aAAGR,YAAY,CAACQ,MADV;AAEN,cAAIP,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACO,MAA1E;AAFM,SAHc;AAOtBC,QAAAA,iBAAiB,EAAET,YAAY,CAACS,iBAPV;AAQtBC,QAAAA,eAAe,EAAEV,YAAY,CAACU,eARR;AAStBC,QAAAA,oBAAoB,EAAEX,YAAY,CAACW,oBATb;AAUtBC,QAAAA,OAAO,EAAEX,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACW,OAVzD;AAWtBC,QAAAA,gBAAgB,EAAEb,YAAY,CAACa,gBAXT;AAYtBC,QAAAA,oBAAoB,EAAEd,YAAY,CAACc;AAZb,OAAb,EAaRX,iBAbQ,CAAX;AAcD;AApBS,GAAD,EAqBRY,MAAM,CAACC,MAAP,CAAc3C,aAAd,CArBQ,CAHX;AAyBA,SAAOyB,MAAP;AACD,CA3BD;;AA6BA,eAAeF,sBAAf","sourcesContent":["import { isFunction, logger, throttle } from \"@rpldy/shared\";\nimport addLife from \"@rpldy/life-events\";\nimport defaultSend from \"@rpldy/sender\";\nimport { PROGRESS_DELAY, SENDER_EVENTS } from \"./consts\";\nimport { DEFAULT_OPTIONS, DEFAULT_PARAM_NAME } from \"./defaults\";\n\nconst reportItemsProgress = (items, completed, loaded, trigger) => {\n  items.forEach(item => {\n    logger.debugLog(`uploady.uploader.processor: file: ${item.id} progress event: loaded(${loaded}) - completed(${completed})`);\n    trigger(SENDER_EVENTS.ITEM_PROGRESS, item, completed, loaded);\n  });\n};\n\nconst onItemUploadProgress = (items, batch, e, trigger) => {\n  const completed = Math.min(e.loaded / e.total * 100, 100),\n        completedPerItem = completed / items.length,\n        loadedAverage = e.loaded / items.length;\n  reportItemsProgress(items, completedPerItem, loadedAverage, trigger);\n  trigger(SENDER_EVENTS.BATCH_PROGRESS, batch);\n};\n\nconst createBatchItemsSender = () => {\n  const {\n    trigger,\n    target: sender\n  } = addLife({\n    send: (items, batch, batchOptions) => {\n      const destination = batchOptions.destination,\n            url = destination === null || destination === void 0 ? void 0 : destination.url;\n      const throttledProgress = throttle(e => onItemUploadProgress(items, batch, e, trigger), PROGRESS_DELAY, true);\n      const send = isFunction(batchOptions.send) ? batchOptions.send : defaultSend;\n      return send(items, url, {\n        method: (destination === null || destination === void 0 ? void 0 : destination.method) || batchOptions.method || DEFAULT_OPTIONS.method,\n        paramName: (destination === null || destination === void 0 ? void 0 : destination.filesParamName) || batchOptions.inputFieldName || DEFAULT_PARAM_NAME,\n        params: { //TODO: might need to rethink the order here:\n          ...batchOptions.params,\n          ...(destination === null || destination === void 0 ? void 0 : destination.params)\n        },\n        forceJsonResponse: batchOptions.forceJsonResponse,\n        withCredentials: batchOptions.withCredentials,\n        formatGroupParamName: batchOptions.formatGroupParamName,\n        headers: destination === null || destination === void 0 ? void 0 : destination.headers,\n        sendWithFormData: batchOptions.sendWithFormData,\n        formatServerResponse: batchOptions.formatServerResponse\n      }, throttledProgress);\n    }\n  }, Object.values(SENDER_EVENTS));\n  return sender;\n};\n\nexport default createBatchItemsSender;"]},"metadata":{},"sourceType":"module"}